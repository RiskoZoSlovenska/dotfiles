#!/bin/sh
# Risko's RC file
# Copy to ~/.riskorc and then run from the shell's RC file

shell="$(basename -- "$SHELL")"


# Running commands
stty -ixon # https://superuser.com/a/473051


# PATH additions
PATH="$PATH:$HOME/.local/bin"
PATH="$PATH:$HOME/.local/sbin"


# Pager
if pager="$(command -v most)"; then
	export PAGER="$pager"
	export SYSTEMD_PAGER="$pager"
	export SYSTEMD_PAGERSECURE=true
fi


# Aliases
alias la='ls -A'
alias ll='ls -lh'
alias lla='ll -A'
alias where='command -V'
alias rawclip='xclip -selection clipboard'
alias clip='tee /dev/tty | rawclip'
alias epath='echo $PATH'
alias refresh='exec $SHELL'
alias grep='grep --color=auto'
alias cgrep='grep --color=always'
alias pyserver='py -m http.server'
alias ping8='ping 8.8.8.8'
alias ping1='ping 1.1.1.1'
alias pingg='ping google.com'

alias ffmpeg='ffmpeg -hide_banner'
alias base64='base64 --wrap=0'

alias python='python3'
alias py='python'
alias pip='pip3'

alias lur='luarocks'
alias luri='lur install'
alias lurr='lur remove'
alias lurl='lur list'
alias lurm='lur make'
alias lurt='lur test'
alias lurmt='lur make && lur test'

alias lcur='luaver current'
alias luse51='luaver use 5.1.5'
alias luse52='luaver use 5.2.4'
alias luse53='luaver use 5.3.6'
alias luse54='luaver use 5.4.4'


# Functions
riskohelp () {
	cat << EOM
Hi future me, here's a list of things your custom configuration adds, in case
you've forgotten:
  * la, ll and lla aliases
  * epath alias to echo the current \$PATH
  * pyserver alias to start http server
  * ping8, ping1 and pingg aliases to ping 8.8.8.8, 1.1.1.1 and google.com
  * clip and rawclip aliases to pipe stdout to your clipboard (requires xclip)
      (rawclip just pipes, clip copies and pipes)
  * cgrep alias to grep with forced color
  * refresh alias to exec the current shell
  * luarocks aliases (lur, luri, etc.)
  * luaver aliases (lcur, luse51, etc.)
  * The riskohelp function, which... well, which you just used.
  * The addtopath function
      Takes a string and appends it to a guessed RC file. Also exec's
      your \$SHELL so you don't have to.
  * The erc function
      Opens RC files in code. No arg for .riskorc, 'b' for .bashrc, 'ba' for
      .bash_aliases or 'z' for .zshrc.
  * The printcomposeextra and printinputextra functions which just print stuff
    to place into ~/.XCompose and ~/.inputrc.
  * Other aliases to run various commands with friendlier default options
EOM
}

addtopath() {
	if [ "$1" = "--help" ]; then riskohelp; fi

	case $shell in
	bash)
		pathsfile=~/.bashrc
		;;
	zsh)
		pathsfile=~/.zshrc
		;;
	*)
		echo >&2 "cannot find file to which append PATH expansion statement"
		return 1
		;;
	esac

	echo "Appending to $pathsfile and exec'ing $SHELL..."
	echo "export PATH=\"\$PATH:$1\"" >> "$pathsfile"
	exec $SHELL
}

erc() {
	case $1 in
	--help|-h)
		riskohelp
		return 0
		;;
	'')
		file=~/.riskorc
		;;
	b)
		file=~/.bashrc
		;;
	ba)
		file=~/.bash_aliases
		;;
	z)
		file=~/.zshrc
		;;
	*)
		echo "unknown option '$1'"
		return 1
		;;
	esac

	if ! [ -f "$file" ]; then
		echo >&2 "file '$file' does not exist" 
		return 1
	fi

	code "$file"
}

printcomposeextra() {
	cat << EOM
# Make sure to include \`include "%L"\` if not already there

# The following Greek stuff was taken from https://askubuntu.com/a/877344
# GREEK CAPITAL LETTERS
<Multi_key> <G> <A> : "Α"    U0391    # GREEK CAPITAL LETTER ALPHA
<Multi_key> <G> <B> : "Β"    U0392    # GREEK CAPITAL LETTER BETA
<Multi_key> <G> <G> : "Γ"    U0393    # GREEK CAPITAL LETTER GAMMA
<Multi_key> <G> <D> : "Δ"    U0394    # GREEK CAPITAL LETTER DELTA
<Multi_key> <G> <E> : "Ε"    U0395    # GREEK CAPITAL LETTER EPSILON
<Multi_key> <G> <Z> : "Ζ"    U0396    # GREEK CAPITAL LETTER ZETA
<Multi_key> <G> <H> : "Η"    U0397    # GREEK CAPITAL LETTER ETA
<Multi_key> <G> <I> : "Ι"    U0399    # GREEK CAPITAL LETTER IOTA
<Multi_key> <G> <K> : "Κ"    U039A    # GREEK CAPITAL LETTER KAPPA
<Multi_key> <G> <L> : "Λ"    U039B    # GREEK CAPITAL LETTER LAMDA
<Multi_key> <G> <M> : "Μ"    U039C    # GREEK CAPITAL LETTER MU
<Multi_key> <G> <N> : "Ν"    U039D    # GREEK CAPITAL LETTER NU
<Multi_key> <G> <P> : "Π"    U03A0    # GREEK CAPITAL LETTER PI
<Multi_key> <G> <R> : "Ρ"    U03A1    # GREEK CAPITAL LETTER RHO
<Multi_key> <G> <S> : "Σ"    U03A3    # GREEK CAPITAL LETTER SIGMA
<Multi_key> <G> <T> : "Τ"    U03A4    # GREEK CAPITAL LETTER TAU
<Multi_key> <G> <U> : "Υ"    U03A5    # GREEK CAPITAL LETTER UPSILON
<Multi_key> <G> <F> : "Φ"    U03A6    # GREEK CAPITAL LETTER PHI
<Multi_key> <G> <X> : "Χ"    U03A7    # GREEK CAPITAL LETTER CHI
<Multi_key> <G> <O> : "Ω"    U03A9    # GREEK CAPITAL LETTER OMEGA

# DOUBLES (additional stroke <Q>)
<Multi_key> <G> <Q> <T> : "Θ"    U0398    # GREEK CAPITAL LETTER THETA
<Multi_key> <G> <Q> <O> : "Ο"    U039F    # GREEK CAPITAL LETTER OMICRON
<Multi_key> <G> <Q> <X> : "Ξ"    U039E    # GREEK CAPITAL LETTER XI
<Multi_key> <G> <Q> <P> : "Ψ"    U03A8    # GREEK CAPITAL LETTER PSI

# greek small letters
<Multi_key> <g> <a> : "α"    U03B1    # GREEK SMALL LETTER ALPHA
<Multi_key> <g> <b> : "β"    U03B2    # GREEK SMALL LETTER BETA
<Multi_key> <g> <g> : "γ"    U03B3    # GREEK SMALL LETTER GAMMA
<Multi_key> <g> <d> : "δ"    U03B4    # GREEK SMALL LETTER DELTA
<Multi_key> <g> <e> : "ε"    U03B5    # GREEK SMALL LETTER EPSILON
<Multi_key> <g> <z> : "ζ"    U03B6    # GREEK SMALL LETTER ZETA
<Multi_key> <g> <h> : "η"    U03B7    # GREEK SMALL LETTER ETA
<Multi_key> <g> <i> : "ι"    U03B9    # GREEK SMALL LETTER IOTA
<Multi_key> <g> <k> : "κ"    U03BA    # GREEK SMALL LETTER KAPPA
<Multi_key> <g> <l> : "λ"    U03BB    # GREEK SMALL LETTER LAMDA
<Multi_key> <g> <m> : "μ"    U03BC    # GREEK SMALL LETTER MU
<Multi_key> <g> <n> : "ν"    U03BD    # GREEK SMALL LETTER NU
<Multi_key> <g> <p> : "π"    U03C0    # GREEK SMALL LETTER PI
<Multi_key> <g> <r> : "ρ"    U03C1    # GREEK SMALL LETTER RHO
<Multi_key> <g> <s> : "σ"    U03C3    # GREEK SMALL LETTER SIGMA
<Multi_key> <g> <t> : "τ"    U03C4    # GREEK SMALL LETTER TAU
<Multi_key> <g> <u> : "υ"    U03C5    # GREEK SMALL LETTER UPSILON
<Multi_key> <g> <f> : "φ"    U03C6    # GREEK SMALL LETTER PHI
<Multi_key> <g> <x> : "χ"    U03C7    # GREEK SMALL LETTER CHI
<Multi_key> <g> <o> : "ω"    U03C9    # GREEK SMALL LETTER OMEGA

# doubles (additional stroke <q>)
<Multi_key> <g> <q> <t> : "θ"    U03B8    # GREEK SMALL LETTER THETA
<Multi_key> <g> <q> <o> : "ο"    U03BF    # GREEK SMALL LETTER OMICRON
<Multi_key> <g> <q> <p> : "ψ"    U03C8    # GREEK SMALL LETTER PSI
<Multi_key> <g> <q> <s> : "ς"    U03C2    # GREEK SMALL LETTER FINAL SIGMA
<Multi_key> <g> <q> <x> : "ξ"    U03BE    # GREEK SMALL LETTER XI

<Multi_key> <z> <space> : "​"    U200B    # ZWSP
EOM
}

printinputextra() {
	cat << EOM
# Make sure to include \`\$include /etc/inputrc\` if not already there

# Case-insensitive tab completion (this one should be built-in for most things)
set completion-ignore-case on

# Taken from https://unix.stackexchange.com/a/264871
"\C-h": backward-kill-word
EOM
}
